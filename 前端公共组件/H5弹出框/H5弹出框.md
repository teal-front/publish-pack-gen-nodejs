# H5弹出框

> 应用场景（移动端）
##### 源码

    define(function() {
	var de = document.documentElement;
	//获取页面信息
	function getPage() {
		return {
			clientWidth: (de.clientWidth || document.body.clientWidth || window.innerWidth),
			clientHeight: (de.clientHeight || document.body.clientHeight || window.innerHeight),
			scrollWidth: de.scrollWidth || document.body.scrollWidth,
			scrollHeight: Math.max(de.scrollHeight, document.body.scrollHeight)
		}
	}

	function isNumber(num) {
		return isFinite(num);
	}

	function Dialog(options) {
		var opts = options || {};
		this.ops = {
			title: opts.title === false ? false : (opts.title || this.defaults.title),
			width: opts.width || '',
			height: opts.height || '',
			timeOut: opts.timeOut || 0,
			top: opts.top,
			html: opts.html === undefined ? '提示内容' : opts.html,
			close: opts.close || false,
			button: opts.button || [],
			zIndex: opts.zIndex || 500,
			onClose: opts.onClose || function() {},
			textAlign: opts.textAlign || 'inherit',
			addClass: opts.addClass || '',
			timeOut: opts.timeOut || 0
		};
		this.layer = document.createElement('div');
		this.wrap = this.layer.cloneNode();
		this.header = this.layer.cloneNode();
		this.strong = document.createElement('strong');
		this.body = this.layer.cloneNode();
		this.content = this.layer.cloneNode();
		this.footer = this.layer.cloneNode();
		this.close = this.layer.cloneNode();
		this.temp = this.layer.cloneNode();
		this.fragment = document.createDocumentFragment();
		this.init();
	}
	Dialog.config = function() {

	};
	Dialog.prototype = {
		version: '1.0',
		name: 'dialog-',
		defaults: {
			title: '提示信息'
		},
		config: function(options) {
			var opts = options || {};
			var config = {
				opacity: opts.opacity || '',
				className: opts.className || ''
			};
			return config;
		},
		init: function() {
			this.setAttr();
			this.create();
			this.event();
			this.setSize();
		},
		event: function() {
			var _this = this;
			this.close.onclick = function() {
				_this.remove();
			};
			this.layer.onclick = function() {
				_this.remove();
			};

			//横屏
			try {
				window.addEventListener('orientationchange', function(ev) {
					_this.setSize();
				}, false);
				window.addEventListener('resize', function() {
					_this.setSize();
				}, false);
			} catch (ev) {}
			if (this.ops.timeOut > 0) {
				setTimeout(function() {
					_this.remove();
				}, this.ops.timeOut);
			}
		},
		setSize: function() {
			var padding = 10,
				page = getPage(),
				clientWidth = page.clientWidth,
				clientHeight = page.clientHeight,
				scrollWidth = page.scrollWidth,
				scrollHeight = page.scrollHeight;
			var top = this.ops.top;
			var width = this.ops.width;
			var height = this.ops.height;

			var wrapHeight = this.wrap.offsetHeight;
			var headerHeight = this.header.offsetHeight;
			var footerHeight = this.footer.offsetHeight;
			var _height = padding * 2 + headerHeight + footerHeight;
			var marginTop = (height + _height) / 2;
			//如果大于窗口则Top为固定
			if (wrapHeight > clientHeight) {
				if (!isNumber(top)) {
					top = padding;
				}
				marginTop = 0;
			}
			//高度填充屏幕
			if (height === 'full') {
				if (!isNumber(top)) {
					top = padding;
				}
				height = clientHeight - _height;
				marginTop = 0;
			}

			this.layer.style.cssText = 'height:' + Math.max(clientHeight, scrollHeight) + 'px;z-index:' + this.ops.zIndex;
			this.wrap.style.cssText = this.wrap.style.cssText + '; top:' + top + 'px; width:' + width + 'px; margin-top:' + -marginTop + 'px; z-index:' + (this.ops.zIndex + 1) + ';';
			this.body.style.cssText = this.body.style.cssText + ';height:' + height + 'px; text-align:' + this.ops.textAlign + ';';

		},
		setAttr: function() {
			this.layer.className = this.name + 'layer';
			this.wrap.className = this.name + 'wrap ' + this.config.className + ' ' + this.ops.addClass;
			this.header.className = this.name + 'header';
			this.body.className = this.name + 'body';
			this.content.className = this.name + 'content';
			this.footer.className = this.name + 'footer clearfix';
			this.close.className = this.name + 'close';
			this.close.innerHTML = '×';

			this.strong.innerHTML = this.ops.title;
			//如果是一个节点
			if (!Dialog.isElement(this.ops.html)) {
				this.content.innerHTML = this.ops.html;
			}

		},
		create: function() {
			var _this = this,
				button,
				buttonLength = this.ops.button.length,
				buttonWidth = 100 / buttonLength;

			//创建Button
			for (var i = 0; i < buttonLength; i++) {
				(function(j) {
					var btn = _this.ops.button[j];
					button = document.createElement(btn.tag || 'button');
					button.style.width = buttonWidth + '%';
					button.innerHTML = btn.text;
					button.className = 'button';
					if (btn.style) {
						button.style.cssText = button.style.cssText + btn.style;
					}
					if (btn.className) {
						button.className = button.className + btn.className;
					}
					if (btn.callback) {
						button.onclick = function() {
							if (btn.callback.call(_this)) {
								_this.remove.call(_this);
							}
						};
					}
				})(i);
				this.fragment.appendChild(button);
			}
			if (this.ops.title) {
				this.header.appendChild(this.strong);
				this.wrap.appendChild(this.header);
			}

			if (Dialog.isElement(this.ops.html)) {
				this.content.appendChild(this.temp);
			}
			this.body.appendChild(this.content);
			this.wrap.appendChild(this.body);
			if (this.ops.button.length) {
				this.footer.appendChild(this.fragment);
				this.wrap.appendChild(this.footer);
			}
			if (this.ops.close) {
				this.wrap.appendChild(this.close);
			}

			document.body.appendChild(this.layer);
			document.body.appendChild(this.wrap);
			this.swapNode();

		},
		swapNode: function() {
			//如果是一个节点
			if (Dialog.isElement(this.ops.html)) {
				Dialog.swapNode(this.temp, this.ops.html);
			}
		},
		removeNode: function(node) {
			if (node && node.nodeName && node.parentNode) {
				node.parentNode.removeChild(node);
				delete node;
			}
		},
		remove: function() {
			var nodes = [this.layer, this.header, this.strong, this.body, this.footer, this.close, this.temp, this.fragment, this.wrap];
			this.swapNode();
			for (var n = 0; n < nodes.length; n++) {
				this.removeNode(nodes[n]);
			}
			this.ops.onClose.call(this);
		}
	};
	//交换节点
	Dialog.swapNode = function(node1, node2) {
		var next, parent;
		if (Dialog.isElement(node1) && Dialog.isElement(node2)) {
			if (document.swapNode) {
				node1.swapNode(node2);
			} else {
				next = node1.nextSibling;
				parent = node1.parentNode;
				node2.parentNode.replaceChild(node1, node2);
				parent.insertBefore(node2, next);
			}
		}
	}
	Dialog.isElement = function(ele) {
		return ele && ele.nodeName ? true : false;
	};
	Dialog.config({
		className: 'asdf'
	});
	var dialog = {
		alert: function(msg, options) {
			var obj = options || {};
			obj.html = msg;
			obj.textAlign = 'center';
			obj.addClass = 'dialog-alert';
			obj.button = [
				//确定
				{
					text: '确定',
					callback: function() {
						return obj.callback ? obj.callback() : true;
					}
				}
			];
			return new Dialog(obj);
		},
		confirm: function(msg, callback) {
			new Dialog({
				html: msg,
				button: [
					//确定
					{
						text: '确定',
						callback: function() {
							return callback ? callback() : true;
						}
					},
					//取消
					{
						text: '取消',
						callback: function() {
							return true;
						}
					}
				]
			});
		},
		prompt: function() {

		},
		message: function(msg, opts) {
			var obj = opts || {};
			obj.title = false;
			obj.html = msg;
			obj.timeOut = 5000;
			obj.top = 100;
			obj.textAlign = 'center';
			obj.addClass = 'dialog-message';
			return new Dialog(obj);
		},
		window: function(opts) {
			new Dialog(opts);
		}
	};

	return dialog;
	});

> 引用方法 使用requirejs

已经进行二次封装，最初的是一个构造函数，二次封装后是一个对象：
    
    
    1. 类型一——alert
    
    dialog.alert('提示信息');

    2. 类型二——confirm
	
	dialog.confirm('提示信息');

    3. 类型二——message

	dialog.message('内容');

    4. 类型四——window
	var options = {
		width: 500,
		height: 300,
		title: '注册',
		html: '内容', //HTML，Or Node
		button: [{
			text: '确定',
			callback: function() {
				//this 就是这个实例化的对象
				//回调
				//关闭窗口1: return true ; 2:this.remove();	
			}
		}]
	};

	dialog.window(options);