/**
 ** 
 ** www.huize.com; 
 ** Version:0.1.0;
 ** Last Updated:2016-08-09; 
 **
 **/
define(["jquery","webuploader","helper"],function($,a,b){"use strict";var c=function(){};return c.prototype={editClassName:"",__randomId:0,getRandomId:function(){return this.__randomId++,"r-"+this.__randomId},initTeam:function(){var a=this,b=" 最小人数："+a.product.minPeople+" 最大人数："+a.product.maxPeople;a.relationship=[];for(var c in a.getRelationship)a.relationship.push({text:a.getRelationship[c],value:c});a.debug&&(2===a.teamTemplateType?a.logRed("团单模板类型：境外模板"+b):a.logRed("团单模板类型：国内模板"+b)),a.cardTypeArr=[],$.each(a.cardType,function(b,c){a.cardTypeArr.push({value:c.controlValue,text:c.value})}),a.setInsuredSomeReg(),a.teamBody=a.el.find("#teamBody"),a.insuredNumber=a.el.find("#insuredNumber"),a.isTeamInsurant&&this.setTeamStatus(),a.eventTeam(),a.resetTotalPrice(),a.eventTeamInit()},setInsuredSomeReg:function(){var a=this.data.modules||[];this.insuredNameReg="",this.insuredNameRegErrorText="",this.insuredTelReg="",this.insuredTelRegErrorText="",this.insuredCardNumberRequire="",this.insuredENameReg="";for(var b=0,c=a.length;c>b;b++)for(var d=a[b].productAttrs||[],e=0,f=d.length;f>e;e++){var g=d[e].attribute||{};d[e].attributeId===this.ATTR_ID_NAME&&(this.insuredNameReg=g.regex,this.insuredNameRegErrorText=g.errorRemind),d[e].attributeId===this.ATTR_ID_TEL&&(this.insuredTelReg=g.regex,this.insuredTelRegErrorText=g.errorRemind),d[e].attributeId===this.ATTR_ID_CREDENTIALSINPUT&&(this.insuredCardNumberRequire=d[e].required,this.insuredCardRegErrorText=d[e].attribute.errorRemind),d[e].attributeId===this.ATTR_ID_ENAME&&(this.insuredENameReg=g.regex,this.insuredENameErrorRemind=g.errorRemind)}},eventTeamInit:function(){var a=this;this.teamBody.css({position:"relative"}),a.teamNum||$(".add-link[type=team]").click();var b;a.teamBody.on("scroll",function(){clearTimeout(b),b=setTimeout(function(){MyCalendar.closeAll()},100)}),a.teamBody.on("blur","li.list-table-row .insure-team-input",function(){a.setTeamItemInfo(this)})},setTeamItemInfo:function(a){var b=this,c=$(a).parents("li"),d=c.data("index");b.teamInfo[d]={type:c.find(".insure-code-type").data("value"),code:c.find(".insure-code").val()||""},b.info(b.teamInfo[d])},validateTeamDateRange:function(){var a=this,b=a.getTeamData()||{},c=a.insuredDate.minDate,d=a.insuredDate.maxDate,e=!0;return a.startTime("校验团单出生日期范围"),$.each(b,function(b,f){var g=f.date||"";g&&(a.dateDifference(c,g)<0||a.dateDifference(d,g)>0)&&(e=!1)}),a.endTime("校验团单出生日期范围"),e},getTeamData:function(){var a=this;return a.startTime("获取团单数据"),a.teamBody.find(".list-table-row").each(function(b,c){var d=$(c).attr("id")||"-";a.teamData[d]={name:$(this).find('[name="cName"]').val(),date:$(this).find("input.Wdate").val(),type:$(this).find(".insure-code-type").data("value"),code:$(this).find(".insure-code").val()}}),a.endTime("获取团单数据"),a.teamData},validateDuplicate:function(a){var b=this,c=a||{},d={},e=[],f=[],g=[],h={},i=0;b.teamBody.find("li").removeClass("dup"),b.getTeamData(),c=this.teamData,$.extend(d,c),b.startTime("校验团单重复项");for(var j in c)for(var k in d)j.toString()!==k.toString()&&c[j].code&&c[j].type===c[k].type&&c[j].code===c[k].code&&(c[j].lock=1,g.push(j));$.each(c,function(a,b){1===b.lock&&(f.push(a),i++)}),$.each(f,function(a,b){h[c[b].code]=b}),$.extend(e,f);for(var l in h){var m=$.inArray(h[l],f);-1!==m&&f.splice(m,1)}return b.endTime("校验团单重复项"),i>0&&!b.saveShopCar&&layer.open({title:"清除重复项",area:["400px"],content:'有<span class="primary-color">'+i+"</span>条重复数据，是否自动清除？",btn:["不清除","清除"],btn1:function(a){$.each(e,function(a,b){$("#"+b).addClass("dup").find(".insure-code").addClass("input-text-error")}),layer.close(a)},btn2:function(){$.each(f,function(a,c){b.teamData[c]=null,delete b.teamData[c],$("#"+c).length&&(b.teamNum--,b.setCloseStatus()),$("#"+c).remove()})}}),{number:i,list:f}},eventTeam:function(){var a=this;a.teamBody.on("click",".close",function(b){a.deleteTeamItem(b)}).on("mouseenter",".list-table-row",function(){}).on("blur",".eidt-item",function(){a.updateTemaValue($(this).parents(".list-table-row"))}).on("mouseleave",".list-table-row",function(){}).on("change",".eidt-item",function(){a.teamItemChange(this)}),a.el.on("click",".add-link",function(){"team"===$(this).attr("type")&&(a.teamNum<a.maxPeople?(a.teamInfo[a.teamIndexs]={},a.addTeamItem(),a.setCloseStatus()):a.showTeamError({type:"max"}))}).on("click",".upload-excel",function(){a.showUploadExcel()})},getUploadHtml:function(){var a=[],b=1===this.teamTemplateType?this.URL_TEMPLATE_DOMESTIC:this.URL_TEMPLATE_FOREIGN,c=1===this.teamTemplateType?"境内旅游模板":"境外旅游模板";return a.push('<div id="uploadArea" style="">'),a.push('<div class="tac  file-upload-start">'),a.push('<p class="f14 mb30">请上传按'+c+'填好的Excel文档。 <a class="download-link tdl" href="'+b+'" target="_blank"> 下载'+c+"</a></p>"),a.push('<a class="hz-button hz-button-primary" href="javascript:;" id="uploadExcel">上传Excel文档</a>'),a.push("</div>"),a.push("</div>"),a.push('<div class="progress-area" id="progressArea" style="display:none">'),a.push('<div class="file-upload-processing">'),a.push('<p class="des">'),a.push('文档：<span id="excelFileName">我是文档名称.xls</span>上传中'),a.push("</p>"),a.push('<div class="progress-bar">'),a.push('<div class="progress f14 tar" style="width: 70%;" id="progressExcel"><span class="text">70%</span></div>'),a.push("</div>"),a.push("</div>"),a.push("</div>"),a.join("")},getUploadingHtml:function(){var a=[];return a.push('<div class="progress-area" id="progressArea">'),a.push('<div class="file-upload-processing">'),a.push('<p class="des">'),a.push('文档：<span id="excelFileName">我是文档名称.xls</span>上传中'),a.push("</p>"),a.push('<div class="progress-bar">'),a.push('<div class="progress f14 tar" style="width: 10%;" id="progressExcel"><span class="text">70%</span></div>'),a.push("</div>"),a.push("</div>"),a.push("</div>"),a.join("")},showUploadExcel:function(){var a=this;layer.open({type:1,title:"批量导入被保人信息（上限为"+a.maxPeople+"人）",area:["870px","480px"],content:a.getUploadHtml(),cancel:function(){return layer.open({title:"取消上传",area:"530px",content:'<div class="pt45 pb45 tac">放弃导入？</div>',btn:["不导入","导入"],cancel:function(){a.__uploadStatus=!0},btn1:function(){a.__uploadStatus=!1,a.swapBtn(),layer.closeAll()},btn2:function(b){a.__uploadStatus=!0,layer.close(b)}}),!1}}),a.swapBtn(),a.teamUpload()},getId:function(a){return"string"==typeof a?document.getElementById(a):a},isElement:function(a){return!(!a||!a.nodeName)},__swapBtnStatus:!0,swapBtn:function(){this.__swapBtnStatus?(this.__swapBtnStatus=!1,$("#uploadExcel1").css({visibility:"visible"})):(this.__swapBtnStatus=!0,$("#uploadExcel1").css({visibility:"hidden"})),this.swapNode("uploadExcel1","uploadExcel")},swapNode:function(a,b){var c,d,e=this.getId(a),f=this.getId(b);return this.isElement(e)&&this.isElement(f)?(document.swapNode?e.swapNode(f):(c=e.nextSibling,d=e.parentNode,f.parentNode.replaceChild(e,f),d.insertBefore(f,c)),!0):void 0},__validClassName:"ok",validateTeam:function(){var a=this,b=!0,c=!0;return a.startTime("验证所有团单"),a.teamBody.find(".list-table-row").not("."+a.__validClassName).each(function(){var d=this;if(a.validateTeamItem(this))$(this).addClass(a.__validClassName);else{if($(this).addClass(a.editClassName),$(this).removeClass(a.__validClassName),b=!1,c){c=!1;var e=$(d).position();a.teamBody.scrollTop(e.top+a.teamBody.scrollTop()),a.scrollTo(a.teamBody)}a.updateTemaValue(d)}}),a.endTime("验证所有团单"),b},validateDateItem:function(a){var b=this,c=a||"",d=!0;return c?((b.dateDifference(b.insuredDate.minDate,c)<0||b.dateDifference(b.insuredDate.maxDate,c)>0)&&(d=!1),d):!1},validateTeamItem:function(a){var b=this,c=!0,d=!0,e=!0;return $(a).find("input.eidt-item").each(function(a,f){var g=$(this),h=g.parents("li.list-table-row").find(".insure-tips"),i=g.data("errorremind")||"",j=g.data("attributeid"),k=$(this).hasClass("Wdate");b.validate(this)||(d&&(d=!1,h.text(i)),c=!1),c&&j===b.ATTR_ID_CREDENTIALSINPUT&&(b.teamCardIdValidate(g)?(g.removeClass("input-text-error"),h.text("")):(g.addClass("input-text-error"),h.text(i),c=!1)),k&&c&&(b.validateDateItem(g.val())?c&&(g.removeClass("input-text-error"),h.text("")):(g.addClass("input-text-error"),i=b.TEXT_INSURED_DATA_ERROR,e&&(e=!1,c&&h.text(i)),c=!1))}),c&&$(a).find(".insure-tips").text(""),c},teamItemChange:function(a){var b=this,c=$(a),d=c.data("attributeid");d===b.ATTR_ID_CREDENTIALSTYPE?b.teamCardTypeEvent(c):d===b.ATTR_ID_CREDENTIALSINPUT?b.teamCardIdEvent(c):d===b.ATTR_ID_RELATIONINSUREINSURANT&&b.teamRelationEvent(c)},teamCardTypeEvent:function(a){var b=this,c=a.data("value"),d=a.parents(".credentials-form");c===b.ATTR_ID_IDCARD?(d.find("[name=birthdate]").attr("disabled",!0),d.find("[name=sex]").addClass("disabled").attr("disabled",!0),d.find("[name=cardNumber]").change()):(d.find("[name=birthdate]").removeAttr("disabled"),d.find("[name=sex]").removeClass("disabled").removeAttr("disabled"))},teamCardIdEvent:function(a){var b=this,c=!0,d=a.val(),e=a.parents(".credentials-form"),f=e.find("[name=cardTypeName]").data("value");if(d&&f===b.ATTR_ID_IDCARD)if(b.identityCodeValid(d)){var g=e.find("[name=birthdate]"),h=e.find("[name=sex]"),i=b.getSex(d),j=b.getIdDate(d);h.removeAttr("disabled"),b.dropdownSelectItem(h,i),h.attr("disabled",!0),g.val(j),g.mouseleave()}else c=!1;return c},teamRelationEvent:function(a){var b=this,c=a.data("value"),d=a.parents(".credentials-form"),e=$("#module-10");if(c===b.SELFRELATIONTYPE){var f=d.find(".form-item");$.each(f,function(){var a=$(this),c=$(this).data("attributeid"),d="",f=e.find("[data-attributeid="+c+"]");d=f.val(),f.hasClass("hz-radio-item")&&(d=e.find("[data-attributeid="+c+"].hz-radio-item-checked").attr("value")),a.hasClass("hz-dropdown")?d&&b.dropdownSelectItem(a,d):(a.val(d),a.change(),a.trigger("blur"))})}},teamCardIdValidate:function(a){var b=this,c=!0,d=a.val(),e=a.parents(".credentials-form"),f=e.find("[name=cardTypeName]").data("value");return d?(f===b.ATTR_ID_IDCARD&&(b.identityCodeValid(d)||(c=!1)),c):c=!1},setCloseStatus:function(a){var b=a||!1;this.startTime("设置状态"),this.setTeamStatus(),this.endTime("设置状态"),this.startTime("初始化日期"),this.initCalendar(),this.endTime("初始化日期"),b||(this.startTime("验证证件类型"),this.teamBody.find("[name=cardTypeName]").change(),this.endTime("验证证件类型"))},setTeamStatus:function(){var a=this;a.resetTotalPrice(),a.insuredNumber.html(a.teamNum+"/"+a.maxPeople)},deleteTeamItem:function(a){var b=this;b.teamBody.find(".close");this.confirm(this.TEXT_DEL,function(){var c=$(a.target).parents(".list-table-row");c.remove(),delete b.teamData[c.attr("id")],b.teamNum--,b.setCloseStatus(),delete b.teamInfo[c.data("index")],b.isTrialChange=!0})},deleteTeamItemActually:function(a){var b=this,c=a;c.remove(),delete b.teamData[c.attr("id")],b.teamNum--,b.setCloseStatus(),b.isTrialChange=!0},scrollTeamBottom:function(){try{this.teamBody.scrollTop(this.teamBody[0].scrollHeight-700)}catch(a){}},addTeamItem:function(a){var b=this,c=a||{name:"",idType:"1",idNumber:"",moblie:""};this.teamBody.append(this.renderTeamItem(c,{addClass:b.editClassName})),b.teamNum++,this.scrollTeamBottom(),b.isTrialChange=!0,b.eventDrowDown(b.teamBody)},updateTemaValue:function(a){$(a).find(".eidt-item").each(function(){var a=$(this).data("text")||$(this).val()||"",b=$(this).parent().find("span.text-item");b.text(a)})},updateTeamIndex:function(){},teamFileType:!0,teamAccept:["xlsx","xls"],__uploadStatus:!0,__uploadProgressInterval:"",__progessNum:0,teamUpload:function(){function b(a){var b=a+"%";a>100&&(b="100%"),d.css({width:b}),e.text(b)}var c=this,d=$("#progressExcel"),e=d.find("span");try{c.uploader.reset()}catch(f){}$("#uploadExcel1").html("上传Excel文档"),c.uploader=new a.Uploader({auto:!0,swf:c.uploadSWFUrl,server:c.uploadUrl,fileSingleSizeLimit:c.SIZE_UPLOAD_EXCEL*c.SIZE_FILE,accept:{title:"filetype",extensions:"xlsx,xls"}}),c.uploader.addButton({id:"#uploadExcel1"}),b(0),c.__uploadStatus=!0,c.uploader.on("error",function(a,b){var d="";switch(c.info(a,b),a){case"F_EXCEED_SIZE":d=c.TEXT_UPLOAD_MAX_SIZE_FN();break;case"Q_TYPE_DENIED":d=c.TEXT_UPLOAD_FORMAT_ERROR}c.message.show(d,"warning",c.messageTimeOut)}),c.uploader.on("uploadStart",function(a){var d=a.name,e="";c.getUploadingHtml();return $("#uploadArea").css({visibility:"hidden"}),c.teamFileType=!0,-1===$.inArray(a.ext,c.teamAccept)&&(c.teamFileType=!1),c.teamFileType?($("#progressArea").show(),e=d.length>30?d.substr(0,30)+"...":d,$("#excelFileName").attr("title",d).text(e),c.startTime("上传Excel时间"),c.__progessNum=0,void(c.__uploadProgressInterval=setInterval(function(){c.__progessNum+=c.getRandomRange(0,10),b(c.__progessNum),(c.__progessNum>100||c.__progessNum>c.getRandomRange(70,100))&&clearInterval(c.__uploadProgressInterval)},50))):(c.message.show(c.TEXT_UPLOAD_FORMAT_ERROR,"warning",c.messageTimeOut),void $("#uploadArea").css({visibility:"visible"}))}),c.uploader.on("uploadSuccess",function(a,d){var e=d||{},f=e.result||[0],g=f[0].fileId;c.__uploadStatus&&(b(100),c.__progessNum=0,c.swapBtn(),layer.closeAll(),c.message.show(c.TEXT_PARSE_EXCEL,"loading",c.messageTimeOut),c.endTime("上传Excel时间"),c.info("文件ID",g),c.parseExcel(g))}),c.uploader.on("uploadError",function(a,b){c.info(a)})},parseExcel:function(a){var b=this;b.teamFileType&&(b.startTime("Java解析Excel时间"),$.ajax({url:b.parseExcelUrl,type:"get",data:{fileId:a,type:b.teamTemplateType},success:function(a){b.message.hide(),b.endTime("Java解析Excel时间"),layer.closeAll(),"00000"!==a.status?b.error(a.message):b.renderTeam(a)},error:function(a){layer.closeAll(),b.error(a.status,a)},complete:function(){}}))},renderTeamWarp:function(){var a,b=this,c=[];return 2===b.teamTemplateType&&b.tableTitleItem.splice(1,0,"英文名"),a=b.tableTitleItem||[],c.push('<div class="person-write-info ">'),c.push('<div class="team-template-'+b.teamTemplateType+'">'),c.push('<div class="insured-list list-table-wrap">'),c.push('<ul class="list-table list-table-head">'),c.push('<li class="list-table-row list-table-row-editing">'),a.forEach(function(a,b){c.push('<div class="cell cell0'+(b+1)+'">'),c.push('<div class="cell-inner">'+a+"</div>"),c.push("</div>")}),c.push("</li>"),c.push("</ul>"),c.push('<ul class="list-table list-table-body" id="teamBody"></ul>'),c.push("</div>"),c.push("</div>"),c.push('<dd class="last-item mt10 tar">'),c.push("</dd>"),c.push("</div>"),c.join("")},renderTeamHeader:function(){var a=[];return a.join("")},renderTeamViewItem:function(a){var b=this,c=a||{},d=[],e=b.trialPrice.buyCount||1;d.push("<tr>"),d.push("<td>"+c.name+"</td>"),2===b.teamTemplateType&&d.push("<td>"+c.eName+"</td>");var f=b.getRelationship[c.rType]||b.getRelationship[23];return d.push("<td>"+b.getRelativeShip(c.idType)+"</td>"),d.push("<td>"+c.idNumber+"</td>"),d.push("<td>"+(c.sex||"男")+"</td>"),d.push("<td>"+c.birthdate+"</td>"),d.push("<td>"+f+"</td>"),d.push("<td>"+e+"份</td>"),d.push("</tr>"),d.join("")},tableTitleItem:["姓名","证件类型","证件号码","性别","出生日期","与投保人关系","份数"],__getNameHTML:function(a,b){var c=this,d=b+' name="cName" data-attributeid="'+c.ATTR_ID_NAME+'" data-name="姓名" ';return'<input type="text" class="insure-team-input input-text insure-form form-item eidt-item"  value="'+a+'" data-defaultRemind="" data-errorremind="'+c.insuredNameRegErrorText+'" data-required="1" data-regex="'+c.insuredNameReg+'" '+d+"/>"},__getENameHTML:function(a,b){var c=this,d=b+' name="eName" data-attributeid="'+c.ATTR_ID_ENAME+'" data-name="英文名" ';return'<input type="text" class="insure-team-input input-text insure-form form-item eidt-item"  value="'+(a||"")+'" data-defaultRemind="" data-errorremind="'+(c.insuredENameErrorRemind||"")+'" data-required="1" data-regex="'+(c.insuredENameReg||"")+'" '+d+"/>"},__getTypeHtml:function(a,b){var c=this,d=a||1,e=b+' name="cardTypeName" data-attributeid="'+c.ATTR_ID_CREDENTIALSTYPE+'"  data-name="证件类型" data-text="'+c.getRelativeShip(d)+'" ';return c.renderSelect({attr:e,listWidth:"150",addClass:" eidt-item insure-code-type ",value:d})},__getCodeHTML:function(a,b,c){var d=this,e=b||1,f=c+'  name="cardNumber" data-attributeid="'+d.ATTR_ID_CREDENTIALSINPUT+'"  data-name="证件号码" data-regex="'+(d.cardNumRegex[e]||"")+'" data-required="'+d.insuredCardNumberRequire+'" data-errorremind="'+d.insuredCardRegErrorText+'" ';return'<input type="text" class="insure-team-input input-text insure-form form-item insure-code eidt-item" value="'+a+'" '+f+"/>"},__getRelationshipHTML:function(a,b){var c=this,d=b+' name="relationInsureInsurant" data-attributeid="'+c.ATTR_ID_RELATIONINSUREINSURANT+'"  data-name="与投保人关系" data-text="'+c.getRelationship[a]+'" ';return c.renderSelect({attr:d,listWidth:"150",addClass:"eidt-item",list:c.relationship||[],value:a||3})},__getBirthdayHTML:function(a,b){var c=this,d=b+' name="birthdate" data-required="1" data-attributeid="'+c.ATTR_ID_BIRTHDATE+'" ';return'<input class="insure-team-input Wdate insure-tel insure-form form-item eidt-item" value="'+(a||"")+'" type="text" '+d+' readonly data-calendartype="team" data-type="team"/>'},__getDelHTMl:function(){return'<a class="close ml5" title="删除" href="javascript:;"><i class="iconfont">&#xe70a;</i></a>'},__getSexHTML:function(a,b){var c=this,d=a||1,e=b+' name="sex" data-attributeid="'+c.ATTR_ID_SEX+'"  data-name="性别" data-text="'+(a||"男")+'" ';return c.renderSelect({attr:e,listWidth:"50",list:[{text:"男",value:1},{text:"女",value:0}],addClass:"eidt-item insure-sex ",value:c.sex[d]})},sex:{"男":1,"女":0},teamData:{},renderTeamItem:function(a,b){var c=this,d=b||{},e=c.teamTemplateType,f=a||{},g=d.addClass||"",h=[],i=(c.relationship||[],' data-moduleid="'+c.MODULES_ID_INSURED+'" '),j=1,k=c.getRandomId(),l=c.trialPrice.buyCount||1,m=f.moblie||"",n=[f.name,f.idType||"1",f.idNumber,f.sex||"男",f.birthdate,f.rType||"23",l+'份<input type="hidden" '+i+' name="buyCount" value="'+l+'" />'],o=6;return 2===e&&(n.splice(1,0,a.eName),o=7),c.teamData[k]={},c.teamIndexs++,h.push('<li class="list-table-row list-table-row-editing '+g+" "+c.insureFormClassName+'" id="'+k+'" data-index="'+c.teamIndexs+'">'),$.each(n,function(a,b){var d="text-item";if(h.push('<div class="cell cell0'+(a+1)+'">'),h.push('<div class="cell-inner">'),a===o&&(d=""),2===e){if(3===a)h.push('<span class="'+d+'">'+c.getRelativeShip(b)+"</span>");else if(5===a){var f=c.getRelationship[b]||c.getRelationship[23];h.push('<span class="'+d+'">'+f+"</span>")}else h.push('<span class="'+d+'">'+b+"</span>");switch(a){case 0:h.push(c.__getNameHTML(b,i));break;case 1:h.push(c.__getENameHTML(b,i));break;case 2:j=b,h.push(c.__getTypeHtml(b,i));break;case 3:h.push(c.__getCodeHTML(b,j,i));break;case 4:h.push(c.__getSexHTML(b||"男",i));break;case 5:h.push(c.__getBirthdayHTML(b,i));break;case 6:h.push(c.__getRelationshipHTML(b,i));break;case 7:h.push(c.__getDelHTMl())}}else{if(2===a)h.push('<span class="'+d+'">'+c.getRelativeShip(b)+"</span>");else if(4===a){var g=c.getRelationship[b]||c.getRelationship[23];h.push('<span class="'+d+'">'+g+"</span>")}else h.push('<span class="'+d+'">'+b+"</span>");switch(a){case 0:h.push(c.__getNameHTML(b,i));break;case 1:j=b,c.teamData[k].type=b,h.push(c.__getTypeHtml(b,i));break;case 2:c.teamData[k].code=b,h.push(c.__getCodeHTML(b,j,i));break;case 3:h.push(c.__getSexHTML(b||"男",i));break;case 4:h.push(c.__getBirthdayHTML(b,i));break;case 5:h.push(c.__getRelationshipHTML(b,i));break;case 6:h.push(c.__getDelHTMl())}}h.push("</div>"),h.push("</div>")}),m&&h.push('<input type="hidden" name="moblie" value="'+m+'" data-moduleid="" />'),h.push('<div class="insure-tips write-info-error"></div>'),h.push("</li>"),h.join("")},teamNum:0,showTeamError:function(a){var b=this,c=a||{},d=["530px","200px"];"min"===c.type?layer.open({type:1,title:!1,btn:["确定"],area:d,content:'<div class="mt30 pt30 tac" ><br />每单最少添加<span class="primary-color">'+b.minPeople+"</span>个被保人，请添加被保人！</div>"}):"max"===c.type?layer.open({type:1,title:!1,btn:["确定"],area:d,content:'<div class="mt30 pt30 tac" >每单最多添加<span class="primary-color">'+b.maxPeople+"</span>个被保险人，超出请分开投保！</div>",end:function(){}}):"tpl"===c.type&&layer.open({type:1,title:!1,area:d,content:'<div class="mt30 pt30 tac" >'+b.TEXT_TEMPLATE_ERROR+"</div>",end:function(){b.showUploadExcel()},btn:["确定"]})},getTeamViewResultHtml:function(){var a=[];return a.push('<div class="name-list-dialog p20">'),a.push('<div class="file-upload-complete">'),a.push('<table class="hz-table ">'),a.push("<thead>"),a.push('<tr class="tal">'),this.tableTitleItem.forEach(function(b){a.push("<th>"+b+"</th>")}),a.push("</tr>"),a.push("</thead>"),a.push('<tbody id="teamView">'),a.push("</tbody>"),a.push("</table>"),a.push("</div>"),a.push("</div>"),a.join("")},isTeamEmpty:function(){var a=this,b=!0;return 1===a.teamNum&&a.teamBody.find(".input-text").each(function(){""!==$.trim($(this).val())&&(b=!1)}),b},teamItemInfo:[],teamInfo:{},teamIndexs:1,renderTeam:function(a,c){var d=this,e=[],f=[],g=a.result||{},h=g.type,i=g.teamPersonInfoList||[],j=0,k=0,l=[],m={};return h!==d.teamTemplateType?void d.showTeamError({type:"tpl"}):(d.isTeamEmpty()&&1===d.teamNum?(k=1,d.teamNum=0):k=0,d.teamNum+i.length-k>d.maxPeople?void d.showTeamError({type:"max"}):(d.startTime("JS渲染Excel时间"),c||layer.open({type:1,title:"上传入"+i.length+"人",area:["870px","480px"],btn:["取消","导入"],btn1:function(a){layer.close(a)},btn2:function(a){d.isTeamEmpty()&&!d.teamNum&&d.teamBody.find(".list-table-row").remove(),d.startTime("导入团单总时间"),d.startTime("导入团单时间"),d.teamBody.append(e.join("")),d.endTime("导入团单时间"),d.teamNum+=j,d.setCloseStatus(!0),d.endTime("导入团单总时间"),layer.close(a),d.teamBody.find("[data-attributeid="+d.ATTR_ID_CREDENTIALSTYPE+"]").change(),d.validateTeam(),$.extend(d.teamInfo,m)},content:d.getTeamViewResultHtml()}),i.forEach(function(a){if(a.birthdate&&a.birthdate.replace(/\s/g,""))try{var c=new Date(a.birthdate.replace(/\s/g,""));if(!c||isNaN(c.getDay()))a.birthdate="";else{var g=d.getCurrentTime(c);a.birthdate=g}}catch(h){a.birthdate=""}a.moblie&&a.moblie.replace(/\s/g,"")&&(a.moblie=a.moblie.replace(/\s/g,""),b.CheckMobile(a.moblie)||(a.moblie="")),j++,e.push(d.renderTeamItem(a)),f.push(d.renderTeamViewItem(a)),void 0!==a.idType&&a.idNumber.length&&(l.push({code:a.idNumber,type:a.idType}),m[d.teamIndexs]={code:a.idNumber,type:a.idType})}),$("#teamView").append(f.join("")),d.endTime("JS渲染Excel时间",function(a,b){d.__renderTeams.push(a),d.caleRenderTeam()}),d.setCloseStatus(),c&&$("#teamBody").append(e.join("")),void d.eventDrowDown(d.teamBody)))},getSameContacts:function(a){var b=this,c=a||{},d=c.type||"",e=c.code||"",f=!1;return d&&e?(b.teamItemInfo=[],b.startTime("判断是否已经有相同联系人"),$.each(b.teamInfo,function(a,c){b.teamItemInfo.push({type:c.type,code:c.code})}),$.each(b.teamItemInfo,function(a,b){d===b.type&&e===b.code&&(f=!0)}),b.endTime("判断是否已经有相同联系人"),f):f},__renderTeams:[],caleRenderTeam:function(){var a=0;$.each(this.__renderTeams,function(b,c){a+=c}),_this.logRed("平均时间："+a/this.__renderTeams.length)},__selectIndex:0,relativeShip:{1:"身份证",2:"护照",3:"出生证",4:"驾照",5:"港澳通行证",6:"军官证",7:"台胞证",8:"警官证",9:"港澳台回乡证",99:"其他"},getRelativeShip:function(a){var b=a||1;return this.relativeShip[b]||"身份证"},renderSelect:function(a){var b=this,c=a||{},d=[],e=c.listWidth||"",f=c.attr,g=c.addClass||"",h=c.list||b.cardTypeArr||[{text:"身份证",value:1},{text:"护照",value:2},{text:"其他",value:99}],i=c.value||"",j=[],k="",l="",m=b.__selectIndex+"-select";return b.__selectIndex++,h.forEach(function(a,b){var c=a||{},d="";+i===+a.value&&(d=" hz-select-option-selected ",k=a.value,l=a.text),j.push('<li class="hz-select-option '+d+' " data-value="'+c.value+'" data-default-value="'+c.value+'">'+c.text+"</li>")}),d.push('<div class="hz-dropdown form-item insure-form form-item '+g+' " data-value="'+(k||1)+'" data-dropdown="'+m+'" '+f+' data-width="'+e+'" data-show="body" data-type="team">'),d.push('<div class="input-select"><span class="input-select-text more-tag no-select">'+l+'</span><b class="iconfont">&#xe70b;</b></div>'),d.push('<div class="hz-dropdown-content" dddd="dd" style="width:'+e+'" data-dropdown-item="'+m+'">'),d.push('<ul class="hz-dropdown-menu">'),d.push(j.join("")),d.push("</ul>"),d.push("</div>"),d.push("</div>"),d.join("")}},c});