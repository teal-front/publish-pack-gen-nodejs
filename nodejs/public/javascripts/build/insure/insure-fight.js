/**
 ** 
 ** www.huize.com; 
 ** Version:0.1.0;
 ** Last Updated:2016-08-09; 
 **
 **/
define(["helper","layer"],function(a,b){"use strict";var c,d=function(){},e=[];return d.prototype={eventInsureFight:function(){var b=this,c="";$("#insureBox").on("click",".flightSelect",function(){var d=this,e=$(d).html();a.request.getJson({url:"/api/tools/airports"},function(a){c=b.renderCityItemHtml(a.result,e),b.showLayer(c,$(d).data("name"),d)})}),$("body").on("click","#alphabetlist .alphabet-item ",function(){$("#alphabetlist .alphabet-item").removeClass("current"),$(this).addClass("current"),$(".accept-country #cityListPanel").html(b.renderCityActiveHtml(e[$(this).data("index")]))})},showLayer:function(a,d,f){var g=this;c||(c=b.open({skin:"huize-layer huize-countries",type:1,title:d,shift:2,btn:["取消","确定"],area:1.5*g.dialogBaseWidth+"px",btn2:function(a){var h,i=$("#cityListPanel :radio:checked"),j=i.val(),k=$("#alphabetlist span.current").data("index"),l=i.data("index");i.length||b.close(a),$(f).prev("input").val(j),$(f).html(j),$("#alphabetlist span.current").data("index"),h="航班出发城市"===d?$("[name='fromAirport']"):$("[name='toAirport']"),g.renderAirPorts(e[k].List[l].airportInfos,h),g.validate(h),b.close(a),c=null},btn1:function(a){b.close(a),c=null},shadeClose:!0,content:'<div class="destination-wrap fight-city-wrap" id="">'+a+"</div>"}))},renderAirPorts:function(a,b,c){$(".hz-dropdown-menu",b).html(""),$.each(a,function(a){(c&&c===this.wordCode||!c&&0===a)&&($(".input-select-text",b).html(this.airportName),$(b).data("value",this.airportName),$(b).data("code",this.wordCode)),$(".hz-dropdown-menu",b).append('<li class="hz-select-option '+(0===a?"hz-select-option-selected":"")+'" wordcode="'+this.wordCode+'" value="'+this.airportName+'" text="'+this.airportName+'">'+this.airportName+"</li>")})},renderCityItemHtml:function(a,b){var c=[],d=this,f=[],g=[];return c.push('<div class="accept-country clearfix">'),c.push('<div class="country-content">'),c.push('<dl class="country-alphabet clearfix" id="alphabetlist">'),c.push("<dd>"),g=d.getCityAlphabet(a),$.each(g,function(a,b){c.push('<span class="alphabet-item fight '+(0===a?"current":"")+'" data-content="'+b+'" data-index="'+a+'">'+b+"</span>")}),c.push("</dd>"),c.push("</dl>"),c.push('<div class="country-box"><ul class="clearfix" id="cityListPanel">'),f=e[0],c.push(d.renderCityActiveHtml(f,b)),c.push("</ul></div></div></div>"),c.join("")},renderCityActiveHtml:function(a,b){var c=[];return $.each(a.List,function(a){var d=this.itemValue===b?'checked="checked"':"";c.push('<li class="country-item">'),c.push('<input class="" type="radio" name="city" id="city'+a+'" value="'+this.itemValue+'" data-index="'+a+'" '+d+"/>"),c.push('<label class="insure-label" for="city'+a+'" title="'+this.itemValue+'">'+this.itemValue+"</label></li>")}),c.join("")},getCityAlphabet:function(a){var b=[];return $.each(a,function(){this.isCityName?e[e.length-1].List.push(this):(b.push(this.itemValue),e.push({name:this.itemValue,List:[]}))}),b},fillAirProtsInfo:function(b,c,d){var e=this;a.request.getJson({url:"/api/tools/airports"},function(a){var f=[];$.each(a.result,function(a,b){b.itemValue===c&&(f=b.airportInfos)});var g=$("[name=flight"+b+"City]");g.val(c),g.next(".flightSelect").html(c);var h;h="From"===b?$("[name=fromAirport]"):$("[name=toAirport]"),e.renderAirPorts(f,h,d)})}},d});