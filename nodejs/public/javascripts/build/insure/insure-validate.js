/**
 ** 
 ** www.huize.com; 
 ** Version:0.1.0;
 ** Last Updated:2016-08-09; 
 **
 **/
define(["jquery"],function($){"use strict";var a=function(){};return a.prototype={validateStatus:!0,validate:function(a,b,c){var d=this,e=!0,f=$(a),g=(f.data("name"),$.trim(f.val()).replace(/\s+/g," ")),h=f.attr("name"),i=f.data("regex"),j=new RegExp(i,"ig"),k=j.test(g),l=d.toInt(f.data("required"));if("cName"===h&&(g=g.replace(/\s+/g,"")),"text"===f.attr("type")&&f.val(g),f.hasClass("hz-dropdown")&&(g=void 0===f.data("value")?"":f.data("value"),g="请选择"===g?"":g,"请选择"===f.find(".hz-select-option-selected").text()&&(g="")),l)if(f.is(":radio")||f.hasClass("hz-radio-item"))d.validateRadio(h)||(f.attr("data-errorremind","请选择"),e=!1);else if($(a).hasClass("hz-check-item")){if(!$(a).hasClass("hz-check-item-checked")&&"clauseInfo"!==$(a).attr("id")){e=!1;var m=$(a).find(".write-info-error");m.text($(a).data("errorremind")||"")}}else g||0===g||"0"===g?k||(e=!1):e=!1;else g&&!k&&(e=!1);if(b&&e&&b.call(d,this),c&&!e&&c.call(d,this),e?b||(d.hideError(a),d.showSuccess(a)):c||(d.hideSuccess(a),d.showError(a)),$(a).hasClass("id-card-input")&&(d.validateCardInput(a)&&d.validateInsuredSameCardInfo(a)||(e=!1)),$(a).hasClass("insure-calendar")){var n=d.toInt($(a).data("moduleid")),o=d.toInt($(a).data("attributeid"));if(o===d.ATTR_ID_BIRTHDATE&&n===d.MODULES_ID_INSURED)d.validateInsureDate(a)||(e=!1);else if(o===d.ATTR_ID_BIRTHDATE&&n===d.MODULES_ID_INSURE)d.validateInsureAge()||(e=!1),d.isSelf&&!d.validateInsureDate(a)&&(e=!1);else if(o===d.ATTR_ID_CREDENTIALSVALIDITY){var p=$(a).attr("maxDate"),q=$(a).attr("minDate"),k=d.dateDifference(q,g)>=0&&d.dateDifference(g,p)>=0;k||(d.hideSuccess(a),d.showError(a,""),e=!1)}}if(e&&$(a).hasClass("buycount")&&(g<d.buyCountRange.min||g>d.buyCountRange.max)&&(d.hideSuccess(a),d.showError(a,"同一被保人同一时间限购"+d.buyCountRange.min+"-"+d.buyCountRange.max+"份"),e=!1),e&&$(a).hasClass("password")){var r=$("[name=password]"),s=$("[name=reconfim-password]"),t=r.val(),u=s.val();t!==u&&(d.hideSuccess(a),d.showError(s[0],"两次输入的密码不一致"),e=!1)}if(e&&("cName"===h||"Lover"===h)){var v=$("[name=Lover]"),w=$("[name=cName][data-moduleid=10]"),x=v.val(),y=w.val();x===y&&(d.hideSuccess(a),d.showError(v," 投保人与心上人姓名不可以相同哦"),e=!1)}return e},validateAll:function(a,b,c){var d=this,e=a||d.el,f=!0,g=!1;e.find("div > .form-item:visible").each(function(){if(!d.validate(this,null,null,c)){var a=$(this).hasClass("insure-team-input");f=!1,g||(g=!0,a?d.scrollTo(d.teamBody):d.scrollTo(this))}});try{var h=d.teamBody.find(".input-text-error").eq(0).position().top,i=d.teamBody.height(),j=d.teamBody[0].scrollHeight;d.info(h),d.info(i),d.info(j),d.teamBody.scrollTop(j-520+h)}catch(k){}return f},validateRadio:function(a){var b=a||"",c=!1,d=$('[name="'+b+'"]');return d.each(function(){$(this).hasClass("hz-radio-item-checked")&&(c=!0)}),c},__defaultIconHTML:"",__successIconHTML:"",__errorIconHTML:"",showError:function(a,b){var c=this,d=$(a),e=d.nextAll(".insure-tips"),f=b||d.data("errorremind")||"";c.saveShopCar||(d.addClass("input-text-error"),e.addClass("write-info-error").html(c.__errorIconHTML+f).removeClass("write-info-success"))},hideError:function(a){var b=$(a),c=b.nextAll(".insure-tips");b.removeClass("input-text-error"),c.removeClass("write-info-error").html("")},showSuccess:function(a){var b=$(a),c=b.nextAll(".insure-tips");b.addClass("input-text-success"),c.addClass("write-info-success").html("")},hideSuccess:function(a){var b=$(a),c=b.nextAll(".insure-tips");b.removeClass("input-text-success"),c.removeClass("write-info-success").html("")},showDefault:function(a,b){var c=this,d=b||$(a).data("defaultremind")||"",e=$(a).nextAll(".insure-tips").eq(0),f=$(a).is(":radio");f||$(a).addClass("insure-info"),e.addClass("write-info-default").html(c.__defaultIconHTML+d)},hideDefault:function(){var a=$(this).nextAll(".insure-tips").eq(0);$(this).removeClass("insure-info"),a.html("").removeClass("insure-tips-info")},fixedInfo:function(a,b){a.show().nextAll(".insure-tips").addClass("write-info-default").text(b)},getSex:function(a){return a=a.trim(),parseInt(a.substr(16,1))%2==1?1:0},getIdDate:function(a){return a=a.trim(),this.identityCodeValid(a)?a.slice(6,10)+"-"+a.slice(10,12)+"-"+a.slice(12,14):""},validateCardInput:function(a){var b,c,d=this,e=$(a).parents(".credentials-form").find(".credentials"),f=d.data.cardNumRegexJson||[],g=d.data.cardNumRemindJson||[],h=~~e.val(),i=f[h]||"^[\\w \\(\\)-]{8,30}$",j=g[h]||"证件号码校验失败：不是有效的证件号码，请核对后重新确认";if($(a).data("errorRemind",j),b=$.trim($(a).val()),!b)return!1;if(c=new RegExp(i,"ig"),!c.test(b))return d.hideSuccess(a),d.showError(a),!1;if(1===h){if(!d.identityCodeValid(b))return d.hideSuccess(a),d.showError(a),!1;if(!this.identityValueValid(a))return!1}return d.hideError(a),d.showSuccess(a),!0},identityCodeValid:function(a){var b,c,d,e,f,g=$.trim(a),h=new Array;return h=g.split(""),g?"111111111111111"==g?!1:(f=parseInt(g.substr(6,4))%4==0||parseInt(g.substr(6,4))%100==0&&parseInt(g.substr(6,4))%4==0?/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/:/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/,f.test(g)?(d=7*(parseInt(h[0])+parseInt(h[10]))+9*(parseInt(h[1])+parseInt(h[11]))+10*(parseInt(h[2])+parseInt(h[12]))+5*(parseInt(h[3])+parseInt(h[13]))+8*(parseInt(h[4])+parseInt(h[14]))+4*(parseInt(h[5])+parseInt(h[15]))+2*(parseInt(h[6])+parseInt(h[16]))+1*parseInt(h[7])+6*parseInt(h[8])+3*parseInt(h[9]),b=d%11,e="F",c="10X98765432",e=c.substr(b,1),e==h[17].toUpperCase()):!1):!1},identityValueValid:function(a){var b=this,c=$(a),d=c.val(),e=b.getSex(d),f=b.getIdDate(d),g=c.data("moduleid"),h=b.getFullAge({nowDate:b.getStartDateValue(),select:d}),i=!0,j=b.getMaxDate(g,b.ATTR_ID_BIRTHDATE),k=b.getMinDate(g,b.ATTR_ID_BIRTHDATE),l=c.parents(".credentials-form"),m=l.find('[data-moduleid="'+g+'"][data-attributeid="'+b.ATTR_ID_SEX+'"]:not(:disabled)'),n="";if((b.dateDifference(k,f)<0||b.dateDifference(f,j)<0)&&(n=g===b.MODULES_ID_INSURE&&18>h?b.TEXT_INSURE_MIN_AGE:"证件对应的年龄不符合投保要求！",i=!1),m.hasClass("hz-radio-item")){var o=!1;m.each(function(a,c){var d=b.toInt($(c).attr("value"));d===e&&(o=!0)}),o||(n="证件对应的性别不符合投保要求！",i=!1)}return i?(b.hideError(a),b.showSuccess(a)):(b.hideSuccess(a),b.showError(a,n)),i},autoSetIdInfo:function(a,b){var c=this,d=$(a),e=b?$(b):d.parents(".credentials-form"),f=e.find(".id-card-input"),g=e.find(".credentials"),h=~~g.val();if(d.hasClass("credentials")&&!c.validateCardInput(f[0]))return!1;if(1===h){var i=f.val(),j=c.getSex(i),k=f.data("moduleid"),l=e.find('input.insure-calendar[data-moduleid="'+k+'"][data-attributeid="'+c.ATTR_ID_BIRTHDATE+'"]'),m=e.find('[data-moduleid="'+k+'"][data-attributeid="'+c.ATTR_ID_SEX+'"]');c.identityCodeValid(i)&&(l.val(c.getIdDate(i)),l.trigger("blur"),m.hasClass("hz-radio-item")?m.each(function(a,b){var d=c.toInt($(b).attr("value"));d===c.VALUE_ID_FEMALE&&j===c.VALUE_ID_FEMALE&&($(b).attr("checked",!0),$(b).click()),d===c.VALUE_ID_MALE&&j===c.VALUE_ID_MALE&&($(b).attr("checked",!0),$(b).click())}):m.val(j),l.change())}return!0},validateInsuredSameCardInfo:function(a){var b=this,c=$(a),d=c.parents(".credentials-form"),e=d.find(".id-card-input"),f=d.find(".credentials"),g=d.data("index"),h=~~f.val(),i=e.val(),j=!0,k=$("#module-20").find(".credentials-form:visible");return e.data("moduleid")!==b.MODULES_ID_INSURED?!0:($.each(k,function(a,c){var d=$(c).find(".id-card-input"),e=$(c).find(".credentials"),f=$(c).data("index"),k=~~e.val(),l=d.val();b.validateCardInput(d[0])&&f!==g&&h===k&&l===i&&(j=!1,b.hideSuccess(d[0]),b.showError(d[0],b.TEXT_SAME_ERROR))}),j||(b.hideSuccess(e[0]),b.showError(e[0],b.TEXT_SAME_ERROR)),j)},defaultSelectIdCard:function(a){var b=this,c=a||b.el,d=c.find("[data-attributeid="+b.ATTR_ID_CREDENTIALSTYPE+"].hz-dropdown");$.each(d,function(){$(this).data("value")||b.dropdownSelectItem(this,1)})},insureCName:"",insurerName:function(a){var b=this,c=$(a).val();b.el.find('.insure-form[data-attributeid="'+b.ATTR_ID_BANK_NAME_1+'"]').val(c).blur(),b.el.find('.insure-form[data-attributeid="'+b.ATTR_ID_BANK_NAME_2+'"]').val(c).blur(),c?($(".js-insure-name").html(c),b.insureCName=c):$(".js-insure-name").html("投保人")}},a});