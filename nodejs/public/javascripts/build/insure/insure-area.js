/**
 ** 
 ** www.huize.com; 
 ** Version:0.1.0;
 ** Last Updated:2016-08-09; 
 **
 **/
define(function(){"use strict";var a=function(){};return a.prototype={initArea:function(){},getAllArea:function(a,b){var c=this,d=a||c.el,e=b||function(){},f=d.find('[select="province"][data-attributeid="'+c.ATTR_ID_AREA_LIVING+'"]'),g=d.find('[select="province"][data-attributeid="'+c.ATTR_ID_AREA_RECEIVER+'"]');(f.length>0||g.length>0)&&this.getAreaData({url:c.getAllAreaUrl,baseProductId:c.baseProductId,isDependInsureArea:1,areaCode:"",callback:function(a){c.allAreaOptions=a,f.data("data",!0),g.data("data",!0),$.each(f,function(b,d){$(this).find(".hz-select-option").length<=1&&c.resetSelect($(this),a)}),$.each(g,function(b,d){$(this).find(".hz-select-option").length<=1&&c.resetSelect($(this),a)}),e.call(this)}});var h=d.find('[select="province"][data-attributeid="'+c.ATTR_ID_AREA_CARD+'"]'),i=d.find('[select="province"][data-attributeid="'+c.ATTR_ID_AREA_ACCOUNT+'"]');(h.length>0||i.length>0)&&this.getAreaData({url:c.getAllAreaUrl,baseProductId:c.baseProductId,isDependInsureArea:0,areaCode:"",callback:function(a){c.allAreaOptions=a,h.data("data",!0),i.data("data",!0),$.each(h,function(b,d){$(this).find(".hz-select-option").length<=1&&c.resetSelect($(this),a)}),$.each(i,function(b,d){$(this).find(".hz-select-option").length<=1&&c.resetSelect($(this),a)}),e.call(this)}})},getFirstInsureArea:function(a,b){var c=this,d=a||c.el,e=b||function(){},f=d.find('[select="province"][data-attributeid="'+c.ATTR_ID_AREA_INSURE+'"]');f.length>0&&this.getAreaData({url:c.getInsureAreaUrl,baseProductId:c.baseProductId,areaCode:"",callback:function(a){c.insureAreaOptions=a,f.data("data",!0),$.each(f,function(b,d){$(this).find(".hz-select-option").length<=1&&c.resetSelect($(this),a)}),e.call(this)}})},getAreaData:function(a){var b=a||{},c={};for(var d in b)"url"!==d&&"callback"!==d&&(c[d]=b[d]);this.jsonp(b.url,c,function(a){var c=[],d=a.result||[];$.each(d,function(a,b){c.push('<li class="hz-select-option " value="'+b.code+'" text="'+b.text+'">'+b.text+"</li>")}),b.callback&&b.callback(c,a)})},changeArea:function(a,b,c){var d=this,e=$(a),f=e.parents("td"),g=d.toInt(e.data("moduleid")),h=d.toInt(e.data("attributeid")),i=(e.attr("name"),0),j=b||e.parents(".credentials-form"),k=e.val(),l=(e.attr("select")||"").toLowerCase(),m=e.nextAll('[select="city"]'),n=e.nextAll('[select="area"]'),o=e.find(".hz-select-option.hz-select-option-selected").attr("text"),p=e.nextAll("input.address-text"),q="",r="",s=c||function(){},t=e.next(".area-text"),u=e.nextAll(".area-text"),v=j.find('.insure-form[data-moduleid="'+g+'"][data-attributeid="20"],.insure-form[data-moduleid="'+g+'"][data-attributeid="22"],.insure-form[data-moduleid="'+g+'"][data-attributeid="24"]');d.resetSelect(m),d.resetSelect(n),m.removeClass("insure-error").hide(),n.removeClass("insure-error").hide(),p.val(""),d.areaText="",h!==d.ATTR_ID_AREA_LIVING&&h!==d.ATTR_ID_AREA_RECEIVER||(i=1),h===d.ATTR_ID_AREA_INSURE?q=d.getInsureAreaUrl:h===d.ATTR_ID_AREA_PROPERTY?q=d.getPropertyAreaUrl:h!==d.ATTR_ID_AREA_LIVING&&h!==d.ATTR_ID_AREA_CARD&&h!==d.ATTR_ID_AREA_ACCOUNT&&h!==d.ATTR_ID_AREA_RECEIVER||(q=d.getAllAreaUrl,f.find("option:selected").each(function(a,b){$(this).val()&&(d.areaText+=$(this).attr("text"))}),v.each(function(a){var b=$.trim($(this).val());b?b===d.defaultAreaText&&$(this).val(d.areaText):$(this).val(d.areaText),d.validate(this)}),d.defaultAreaText=d.areaText),u.val(""),t.val(o),k&&"请选择"!==k&&("province"===l?d.getAreaData({url:q,baseProductId:d.baseProductId,areaCode:k,isDependInsureArea:i,callback:function(a){d.resetSelect(m,a),m.show().data("required",1),s.call(e)}}):"city"===l?(d.getAreaData({url:q,baseProductId:d.baseProductId,areaCode:k,isDependInsureArea:i,callback:function(a){a.length?(d.resetSelect(n,a),n.show().data("required",1),s.call(e)):(d.resetSelect(n),n.hide(),s.call(e,!1))}}),r="",e.parent("td.insure-tab-content").find("select:visible").find("option:selected").each(function(){r+=$(this).attr("text")}),p.val(r)):"area"===l&&(r="",e.parent("td.insure-tab-content").find("select:visible").find("option:selected").each(function(){r+=$(this).attr("text")}),p.val(r)))},setAreaData:function(){var a=this,b=$('select[data-attributeid="'+a.ATTR_ID_AREA_PROPERTY+'"][select="province"]'),c=$('select[data-attributeid="'+a.ATTR_ID_AREA_INSURE+'"][select="province"]'),d=$('select[data-attributeid="'+a.ATTR_ID_JOB+'"][job="1"]'),e=$('select[data-attributeid="'+a.ATTR_ID_AREA_LIVING+'"][select="province"]');b.each(function(b,c){var d=$(this);d.find("option").length<=1&&a.resetSelect(d,a.allAreaOptions)}),e.each(function(b,c){var d=$(this);d.find("option").length<=1&&a.resetSelect(d,a.allAreaOptions)}),c.each(function(b,c){var d=$(this);d.find("option").length<=1&&a.resetSelect(d,a.insureAreaOptions)}),d.each(function(b,c){var d=$(this);d.find("option").length<=1&&a.resetSelect(d,a.jobDataOptions)})},dynamicSettingArea:function(a,b){var c=this,d=$(a),e=$(a).nextAll(".hz-dropdown").eq(0),f=$(a).nextAll(".hz-dropdown").eq(1),g=d.parents(".credentials-form"),h=d.data("attributeid"),i=b||"",j=i.split("-");if(j.length&&d.length)return d.val(""),e.val("").hide(),f.val("").hide(),d.find(".hz-select-option").length<=1?void(h===c.ATTR_ID_AREA_INSURE?c.getFirstInsureArea(g,function(){c.dynamicSettingArea(a,b)}):c.getAllArea(g,function(){c.dynamicSettingArea(a,b)})):void(d.find('.hz-select-option[value="'+j[0]+'"]').length&&(c.setDropdownSelectValue(d,j[0]),c.changeArea(d.get(0),g,function(){return e.find('.hz-select-option[value="'+j[1]+'"]').length?(c.setDropdownSelectValue(e,j[1]),2>=j?void f.hide():void c.changeArea(e.get(0),g,function(){f.find('.hz-select-option[value="'+j[2]+'"]').length&&(c.setDropdownSelectValue(f,j[2]),c.changeArea(f.get(0)),f.change())})):void 0})))}},a});