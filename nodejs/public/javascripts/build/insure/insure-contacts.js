/**
 ** 
 ** www.huize.com; 
 ** Version:0.1.0;
 ** Last Updated:2016-08-09; 
 **
 **/
define(["jquery","layer","helper","insure-validate"],function($,a,b,c){"use strict";var d=(new c,function(){});return d.prototype={isShowContacts:!1,bindContacts:function(c,d,e){var f,g,h,i=this,j=c,k=$(d?d:"#insureBox"),l='<div class="general-contact-dialog layui-layer-wrap" id="contactsList"><% _.each(datas,function(item,index){%><a class="general-contact-name  <%=item.id==activeId?"active":" "%>" href="javascript:;" contactsId="<%=item.id%>"><i class="iconfont f22">&#xe71d;</i><%=item.cName%></a><%})%></div>';k.on("click","a[contactsIndex]",function(){i.isShowContacts||(i.isShowContacts=!0,h=$(this).attr("contactsIndex"),f=$(this).attr("data-contactId"),i.checkLogin(function(){i.getContactdata(function(c){g=_.template(l)({datas:c,activeId:f}),i.isShowContacts=!1,a.open({type:1,shift:2,title:"选择联系人",area:["890px","480px"],shadeClose:!0,content:g,btn1:function(){a.closeAll("page")}}),$("#contactsList").on("click","a",function(){var d,g=e||$(".person-write-info[sort='"+h+"']"),k=!1;"module-10"===g.attr("id")&&(d=$(".insurant [data-insuranttype='myself']"),k=!0),$("#contactsList a").removeClass("active"),$(this).addClass("active"),i.emptyContactsField(g),f=parseInt($("#contactsList a.active").attr("contactsId")),$.each(c,function(c,e){if(!h&&f===e.id)return i.info(e),void(i.getSameContacts({code:e.cardNumber,type:e.cardTypeId})?setTimeout(function(){a.open({title:!1,type:0,area:["530px"],content:'<div class="pt45 pb45 tac">此联系人已经存在</div>',btn:["确定"]})},200):(i.isTeamEmpty()&&1===i.teamNum&&(i.teamNum=0,i.teamBody.find(".list-table-row").remove()),i.addTeamItem({name:e.cName,eName:e.eName,idType:e.cardTypeId,idNumber:e.cardNumber,moblie:e.moblie,birthdate:e.birthdate.slice(0,10)}),i.setCloseStatus(),i.teamInfo[i.teamIndexs]={type:e.cardTypeId,code:e.cardNumber}));if(e.birthdate=b.dateHelper.getDatefromText(e.birthdate),e.id===f){var l;for(var m in e)if("provCityId"===m)l=$("*[name=provCityText][select=province]",g),0===l.length&&k&&(l=$("*[name=provCityText][select=province]",d)),i.dynamicSettingArea(l,e[m]);else if("jobInfo"===m)l=$("*[name=jobText][job=1]",g),0===l.length&&k&&(l=$("*[name=jobText][job=1]",d)),i.dynamicSettingJob(l,e[m]);else if(l=$("*[name^='"+m+"']",g),0===l.length&&k&&(l=$("*[name^='"+m+"']",d)),l.length>0){if(l.hasClass("hz-dropdown"))"cardTypeName"===m&&(m="cardTypeId"),j.dropdownSelectItem(l,e[m]);else if("INPUT"===l[0].tagName&&"text"===l.attr("type")){if("cardPeriod"===m){l=$("*[name='"+m+"']",g);var n=g.find("[name=validityTime]"),o=e[m].split("|");o.length>1?(n.attr("checked",!1),n.parents(".hz-check-item").removeClass("hz-check-item-checked"),g.find("[name=cardPeriodEnd]").val(o[1]),l.nextAll(".validity-end-item").show(),e[m]=o[0]):i.checkboxSelectItem(n.parents(".hz-check-item"))}l.val(e[m]),j.validate(l[0]),l.trigger("blur")}else l.hasClass("hz-radio-item")&&l.each(function(a,b){if("sex"===m){var c=~~$(b).attr("value");c===e[m]&&$(b).click()}});l.attr("trial")&&i.trialChange(l[0])}g.find(".select-contacts-link").attr("data-contactId",f)}a.closeAll("page")});try{$.placeholder.resetStatus()}catch(l){}i.validateAll(g),g.find(".id-card-input").trigger("blur")})})}))})},emptyContactsField:function(a){var b=this;if(a&&a.length>0&&(a.find("input[type='text']:not('.buycount')").val(""),a.find("input[type='text'].buycount").val(a.find("input[type='text'].buycount").attr("defaultvalue")),a.find(".hz-dropdown").each(function(){b.dropdownSelectItemClear(this)}),"module-10"===a.attr("id"))){var c=$(".insurant [data-insuranttype='myself']");c.find("input[type='text']:not('.buycount')").val(""),c.find("input[type='text'].buycount").val(c.find("input[type='text'].buycount").attr("defaultvalue")),c.find(".hz-dropdown").each(function(){b.dropdownSelectItemClear(this)})}},getContactdata:function(a){var b=this;$.ajax({url:"/api/users/contacts?t="+(new Date).getTime(),type:"get",success:function(b){a&&b&&a(b.result)},error:function(a){b.error(a.status,a)}})},fillSelfInfo:function(){var a=this,c=!0,d=a.insurance.aftertEdit;$.each(a.ruleParam.genes,function(b,d){d.key&&(d.key!==a.INSURANTDATEKEY&&d.key!==a.VESTERAGEKEY&&d.key!==a.SEXKEY||(c=!1))}),!d&&c&&a.getContactdata(function(c){$.each(c,function(){this.birthdate=b.dateHelper.getDatefromText(this.birthdate),1===this.relationShip&&a.setKeyValue(this,$("#module-10"))})});var e=$("[data-moduleid="+a.MODULES_ID_INSURE_DATE+"][data-attributeid="+a.ATTR_ID_INSURE_DATE+"]");a.showInsurantDateLimit(e);var f={};f.newDate=e.val(),a.setInsuredDate(f)}},d});