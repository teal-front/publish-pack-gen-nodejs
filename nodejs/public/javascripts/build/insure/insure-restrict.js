/**
 ** 
 ** www.huize.com; 
 ** Version:0.1.0;
 ** Last Updated:2016-08-09; 
 **
 **/
define(function(){"use strict";var InsureRestrict=function(){};return InsureRestrict.prototype={restrictId:{},restrictStatus:{},getREstrictStatus:function(){var a=this,b=!0,c=!0;return $.each(this.restrictStatus,function(d,e){var f=e;!1===f.status&&(b=!1,c&&(c=!1,a.scrollTo(f.element),a.showError(f.element,f.errorText)))}),b},defaultRestrict:function(a){var b=this,c=b.insureIncludeBirthday,a=a||this.el,d="";1===b.insuredAgeCalculation&&(d=b.getFixedDateValue()),$.each(b.restricts,function(e,f){var g=f.results||[];1===f.type&&$.each(g,function(e,f){var g=b.$get(f.moduleId,f.attributeId);g=a?a.find('.insure-form[data-moduleid="'+f.moduleId+'"][data-attributeid="'+f.attributeId+'"]'):g;var h=(g.val(),f.value),i=g.is(":radio")||g.hasClass("hz-radio-item"),j=g.is("select")||g.hasClass("hz-dropdown");switch(f.conditions){case 0:if(0===f.unit);else if(7===f.unit||13===f.unit){var k,l;k=b.createDate({newDate:d,year:-f.value,date:c}),l=b.createDate({newDate:d,year:-b.maxAge,date:c}),b.compareTime({type:1,maxDate:k,minDate:l,item:f})}else if(10===f.unit){var k,l;k=b.createDate({newDate:d,date:-f.value+c-1}),b.compareTime({type:1,maxDate:k,item:f})}break;case 1:if(3===f.unit){var m={value:f.value,conditions:f.conditions,unit:f.unit};b.restrictId[f.restrictId]=m,b.$get(f.moduleId,f.attributeId).data("restrictId",f.restrictId).addClass("validate-restricts-value")}else if(10===f.unit){var k=b.createDate({newDate:d,date:-f.value+c}),l=b.createDate({year:-1,date:-f.value+c});b.compareTime({type:1,item:f,maxDate:k})}break;case 4:0===f.unit&&(i?b.restrictRadio(g,h,f.conditions):j&&b.defaultRestrictSelect(g,f.value,4));break;case 5:0===f.unit&&(j?b.defaultRestrictSelect(g,f.value,5):i&&b.restrictRadio(g,h,f.conditions,1));break;case 6:0===f.unit&&(i?b.restrictRadio(g,h,f.conditions):j&&b.defaultRestrictSelect(g,f.value,5));break;case 7:0===f.unit&&(i?b.restrictRadio(g,h,f.conditions):j&&b.defaultRestrictSelect(g,f.value,4));break;case 8:g.next().hasClass("js-insure-tips")||g.after('<span class="js-insure-tips pl5" >'+f.value+"</span>");break;case 9:g.parents("tr").hide().find(".insure-form").attr("disabled",!0)}f.moduleId===b.MODULES_ID_INSURED&&(f.attributeId===b.ATTR_ID_BUYCOUNT&&b.setBuyRestrictCountRange(f),f.attributeId===b.ATTR_ID_CREDENTIALSTYPE&&(b.cardType=b.defaultRestrictSelectValue(b.cardType,f.value,f.conditions)),f.attributeId===b.ATTR_ID_RELATIONINSUREINSURANT&&(b.relationships=b.defaultRestrictSelectValue(b.relationships,f.value,f.conditions)))})}),b.runGenesRestrict()},eventRestrict:function(){var a=this;a.el.delegate(".insure-form","change",function(){$(this).attr("executes")&&a.restrictRun(this)}).delegate(".insure-form.hz-radio-item","click",function(){$(this).attr("executes")&&a.restrictRun(this)}).delegate(".insure-form","blur",function(){$(this).attr("executes")&&!$(this).hasClass("insure-birthdate")&&a.restrictRun(this)})},restrictCale:function(val1,conditions,val2){var status=!1;return status=!!eval(val1+conditions+val2)},setGeneralRestrictsItem:function(){var a=this;$.each(a.restricts,function(b,c){var d=c.executes||[];c.results||[];$.each(d,function(b,c){var d=a.$get(c.moduleId,c.attributeId);d.parents(".credentials-form");d.attr("executes",!0)})})},selectContain:function(a,b){var c=!1,d=b||"",e=d.split(","),f=a.hasClass("hz-dropdown")?a.find(".hz-select-option-selected"):a.find("option:selected");return f.length>0&&-1!==$.inArray(f.val().toString(),e)&&(c=!0),c},restrictRunStatus:{},selectChangeBefore:{},selectChangeBeforeValue:{},restrictSelect:function(a){var b=this,c=a.value||"",d=c.split(","),e=a.key,f=(a.form.val(),a.form.hasClass("hz-dropdown")?a.form.find(".hz-dropdown-content  .hz-select-option"):a.form.find("option"));if(a.status?(b.selectChangeBeforeValue[e]||(b.selectChangeBeforeValue[e]=a.form.val()),b.selectChangeBefore[e]||(b.selectChangeBefore[e]=f.clone(!0)),f.each(function(b){var c=$(this).attr("value").toString();c&&(5===a.conditions||6===a.conditions?-1===$.inArray(c,d)&&$(this).remove():7===a.conditions&&-1!==$.inArray(c,d)&&$(this).remove())}),b.validate(a.form)):(b.selectChangeBefore[e]&&(a.form.hasClass("hz-dropdown")?a.form.find(".hz-dropdown-menu").empty().append(b.selectChangeBefore[e]).val(b.selectChangeBeforeValue[e]):a.form.empty().append(b.selectChangeBefore[e]).val(b.selectChangeBeforeValue[e]),delete b.selectChangeBefore[e],delete b.selectChangeBeforeValue[e]),b.validate(a.form)),a.form.find(".hz-select-option-selected").length<1){var g=a.form.find(".input-select-text");g.is(":text")?g.val("请选择"):g.text("请选择"),a.form.data("value","请选择").attr("value","请选择")}},setRadioStatus:function(a,b){},restrictRadioNew:function(a){var b=a.parent.find('[data-moduleid="'+a.moduleId+'"][data-attributeid="'+a.attributeId+'"]');b.each(function(){var b=($(this).attr("id"),$(this).next("label"),$(this).val()||$(this).attr("value"));4===a.conditions||7===a.conditions?b===a.value&&a.status?($(this).hide(),$(this).attr("disabled",!0)):($(this).show(),$(this).removeAttr("disabled")):5!==a.conditions&&6!==a.conditions||(b===a.value?($(this).show(),$(this).removeAttr("disabled")):a.status?($(this).hide(),$(this).attr("disabled",!0)):($(this).show(),$(this).removeAttr("disabled")))})},getStatus:function(a,b,c){return 0===a?c=b?c:!1:1===a&&(c=b||c),c},restrictRun:function(a){var b=this,c=$(a),d=c.parents(".credentials-form"),e=b.toInt(c.data("moduleid")),f=b.toInt(c.data("attributeid"));b.restrictRunStatus={},$.each(b.restricts,function(a,f){var g=f.executes||[],h=f.results||[],i=(f.name,0===f.executeType),j=(f.id,f.executeType);0===f.type&&($.each(g,function(a,f){var g,h,k,l,m,n,o,p=f.moduleId,q=f.attributeId,r=(f.restrictId,f.unit),s=b.getConditions[f.conditions],t=f.value;d=b.MODULES_ID_INSURED===p&&e===p?c.parents(".credentials-form"):b.el,g=d.find('[data-moduleid="'+p+'"][data-attributeid="'+q+'"]'),h=d.find('[data-moduleid="'+p+'"][data-attributeid="'+q+'"].hz-radio-item-checked'),b.logRed(g.length),k=g.is("select")||g.hasClass("hz-dropdown"),l=g.is(":radio")||g.hasClass("hz-radio-item"),m=g.is("input"),o=g.val(),l&&(o=h.val()||h.attr("value")),0===r?6===f.conditions?l&&(g=h,n=o===t,i=b.getStatus(j,n,i)):4===f.conditions?l&&(g=h,n=o!==t,i=b.getStatus(j,n,i)):7===f.conditions?l&&(g=h,n=o===t,i=b.getStatus(j,n,i)):l?(g=h,n=o===t,i=b.getStatus(j,n,i)):k&&(n=b.selectContain(g,t),i=b.getStatus(j,n,i)):7!==r&&13!==r||m&&(o=b.getFullAge({select:o}),n=b.restrictCale(o,s,t),i=b.getStatus(j,n,i))}),$.each(h,function(a,f){var g,h=f.moduleId,j=f.attributeId,k=f.conditions,l=b.replaceNull(f.value),m=(f.unit,f.restrictId);d=b.MODULES_ID_INSURED===h&&e===h?c.parents(".credentials-form"):b.el,g=d.find('[data-moduleid="'+h+'"][data-attributeid="'+j+'"]'),g.each(function(a){var c=$(this),d=c.parents(".credentials-form"),e=c.nextAll(".default-tips"),f=d.data("index"),g=f+"["+m+"]";b.restrictRunStatus[g]||(b.restrictRunStatus[g]={}),b.restrictRunStatus[g].parent=d,b.restrictRunStatus[g].status=i,b.restrictRunStatus[g].moduleId=h,b.restrictRunStatus[g].attributeId=j,b.restrictRunStatus[g].key=g,b.restrictRunStatus[g].value=l,b.restrictRunStatus[g].form=c,b.restrictRunStatus[g].conditions=k,e.text("")})}))}),$.each(b.restrictRunStatus,function(a,c){var d;switch(c.conditions){case 0:break;case 1:break;case 2:break;case 3:break;case 4:break;case 5:break;case 6:break;case 7:break;case 8:c.status&&(d=c.form.nextAll(".default-tips"),d.text(c.value));break;case 9:c.status?c.form.parents("tr").hide():c.form.parents("tr").show()}if(c.form.is("select")||c.form.hasClass("hz-dropdown")){if(f===b.restrictRunStatus[a].attributeId)return;b.restrictSelect(c)}else(c.form.is(":radio")||c.form.hasClass("hz-radio-item"))&&b.restrictRadioNew(c)})},restrictDefaultTeam:function(){},resetRestrictedSelectValue:function(a,b,c){var d={};return this.$get(a,b).eq(0).find("option").each(function(a,b){var c=$(this).attr("value"),e=$(this).text();c&&(d[c]=e)}),d},getFixedDateValue:function(){var a=$(".fixed-date").val();return a||(a=this.startDate.minDate),a},restrictRadio:function(a,b,c,d){var d=d||1;a.each(function(a,e){var f=$(e).val()||$(e).attr("value"),g=$(e).attr("id"),h=$('[for="'+g+'"]');if(4===c||7===c){if(f!==b)return;1===d?($(e).remove(),h.remove()):2===d&&($(e).hide(),h.hide())}else if(5===c||6===c){if(f===b)return;1===d?($(e).remove(),h.remove()):2===d&&($(e).hide(),h.hide())}})},defaultRestrictSelect:function(a,b,c){var d=b||"",e=d.split(","),c=c||5,f=this,g=[];if(a.hasClass("select-area")&&(a=a.eq(0)),g=a.hasClass("hz-dropdown")?a.find(".hz-dropdown-content  .hz-select-option"):a.find("option"),a.data("attributeid")===this.ATTR_ID_RELATIONINSUREINSURANT){var h=[];e.forEach(function(a,b){var c=!1;f.RELATIONMAP.forEach(function(b,d){b.defaultValue.toString()===a&&(c=!0,b.transRelation.forEach(function(a,b){h.push(a.controlValue)}))}),c||h.push(a)}),d=h.join(","),e=d.split(","),f.defaultRestrictSelect(this.forRelationTypeSelect,d,c)}g.each(function(){var b=$(this).attr("value")||$(this).attr("data-value");a.hasClass("select-area")&&b&&(b=$(this).attr("text")),b=b?b.toString():"",5===c?b&&-1===$.inArray(b,e)&&$(this).remove():4===c&&b&&-1!==$.inArray(b,e)&&$(this).remove()})},defaultRestrictSelectValue:function(a,b,c){var d=[],e=b||"",f=e.split(",");return a&&a.forEach(function(a){var b=a.controlValue.toString();5===c||6===c?b&&-1!==$.inArray(b,f)&&d.push(a):4!==c&&7!==c||b&&-1===$.inArray(b,f)&&d.push(a)}),d},compareTime:function(a){var b=this,c=a||{},d=c.item||{};20===d.moduleId&&(c.maxDate&&(b.dateDifference(b.date.maxDate,c.maxDate)<0?(b.insuredDate.maxDate=c.maxDate,1===c.type&&(b.date.maxDate=c.maxDate,b.insuredDate.maxValue=d.value,b.insuredDate.unit=d.unit)):b.insuredDate.maxDate=b.date.maxDate),c.minDate&&(b.dateDifference(b.date.minDate,c.minDate)<0?(b.insuredDate.minDate=c.minDate,1===c.type&&(b.date.maxDate=c.minDate)):b.insuredDate.minDate=b.date.minDate))},buyCountRange:{min:1,max:1e4},setBuyRestrictCountRange:function(a){var b=this,c=parseInt(a.value);if(1===a.unit)switch(a.conditions){case 0:var d=b.buyCountRange.min>c+1?b.buyCountRange.min:c+1;b.buyCountRange.min=d;break;case 1:var d=b.buyCountRange.min>c?b.buyCountRange.min:c;b.buyCountRange.min=d;break;case 2:var e=b.buyCountRange.max<c-1?b.buyCountRange.max:c-1;b.buyCountRange.max=e;break;case 3:var e=b.buyCountRange.max<c?b.buyCountRange.max:c;b.buyCountRange.max=e}},insureBeforeRestrict:{},selfDefaultRestrict:function(){var a=this;$.each(a.restricts,function(b,c){var d=c.results||[];1===c.type&&$.each(d,function(b,c){if(c.moduleId===a.MODULES_ID_INSURED){var d=$("#module-10").find(".insure-form[data-moduleid=10][data-attributeid="+c.attributeId+"]");if(d.length>0){var e=(d.val()||d.attr("value"),c.value),f=d.is(":radio")||d.hasClass("hz-radio-item"),g=d.is("select")||d.hasClass("hz-dropdown");c.attributeId;switch(a.insureBeforeRestrict[c.attributeId]||(g?a.insureBeforeRestrict[c.attributeId]=d.find(".hz-select-option"):f&&(a.insureBeforeRestrict[c.attributeId]=d.parent(".field-row").html())),c.conditions){case 0:break;case 1:break;case 4:0===c.unit&&(f?a.restrictRadio(d,e,c.conditions):g&&a.defaultRestrictSelect(d,c.value,4));break;case 5:0===c.unit&&(g?a.defaultRestrictSelect(d,c.value,5):f&&a.restrictRadio(d,e,c.conditions,1));break;case 6:0===c.unit&&(f?a.restrictRadio(d,e,c.conditions):g&&a.defaultRestrictSelect(d,c.value,5));break;case 7:0===c.unit&&(f?a.restrictRadio(d,e,c.conditions):g&&a.defaultRestrictSelect(d,c.value,4));break;case 8:break;case 9:}}}})})},restSelfDefaultRestrict:function(){var a=this;$.each(a.restricts,function(b,c){var d=c.results||[];1===c.type&&$.each(d,function(b,c){if(c.moduleId===a.MODULES_ID_INSURED){var d=$("#module-10").find(".insure-form[data-moduleid=10][data-attributeid="+c.attributeId+"]");if(d.length>0){var e=(d.val()||d.attr("value"),c.value,d.is(":radio")||d.hasClass("hz-radio-item")),f=d.is("select")||d.hasClass("hz-dropdown");c.attributeId;a.insureBeforeRestrict[c.attributeId]&&(f?d.find(".hz-dropdown-menu").html(a.insureBeforeRestrict[c.attributeId]):e&&d.parent(".field-row").html(a.insureBeforeRestrict[c.attributeId]))}}})})}},InsureRestrict});