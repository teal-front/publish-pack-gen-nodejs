/**
 ** 
 ** www.huize.com; 
 ** Version:0.1.0;
 ** Last Updated:2016-08-09; 
 **
 **/
define(["jquery","helper","fixed-tool-float","layer"],function($,a,b,c){"use strict";var d={toolFloat:{},oppName:"",planId:0,notifyAnswerId:0,insureNum:"",init:function(){var c=this;c.oppName=a.url.getUrlVar("oppName")||"预约频道商机",c.planId=a.url.getUrlVar("planId")||a.url.getUrlVar("planid")||0,c.notifyAnswerId=a.url.getUrlVar("notifyAnswerId")||0,c.insureNum=a.url.getUrlVar("insureNum")||0,c.getYuyueCount(!1),c.toolFloat=new b,$(".hz-dropdown").dropDown({type:1,time:50,event:function(a){return!$(a.target).hasClass("iconfont")&&!$(a.target).hasClass("more-tag")},select:function(a){return c.dropdownSelect(this,a)}}),$(".booking-tab li").click(function(){$(this).addClass("active").siblings("").removeClass("active");var a=$(this).index();$(".booking-tab-con li").eq(a).show().siblings("").hide()}),$(".booking-input").bind("blur",function(){c.validateItem(this)}),$("#btnReserve").bind("click",function(){c.submitData()})},dropdownSelect:function(a,b){var c=b.target,d=$(c),e="",f=d.parents(".hz-dropdown");return d.hasClass("hz-select-option")?(e=d.text(),f.find(".input-select-text").html(e),f.find(".hz-select-option-selected").removeClass("hz-select-option-selected"),d.addClass("hz-select-option-selected"),$("#errorMsg").text(""),f.removeClass("input-text-error"),!0):!1},validateItem:function(b){var c=this,d=$(b),e=$.trim(d.val()),f=!0,g="",h=$("#errorMsg");return d.hasClass("hz-dropdown")?d.find(".hz-select-option-selected").length>0?f=!0:(f=!1,g="请选择联系您的时间！"):(d.val(e),"tel"===d.attr("id")?e?a.CheckMobile(e)?f=!0:(f=!1,g="请输入正确的手机号！"):(f=!1,g="请输入您的手机号码！"):e?c.checkName(e)?f=!0:(f=!1,g="您输入的姓名格式不正确,请输入正确的姓名！"):(f=!1,g="请输入您姓名！")),f?(d.removeClass("input-text-error"),h.html("")):(d.addClass("input-text-error"),h.html(g)),f},lodding:!1,submitData:function(){if(this.lodding)return!1;var b=this,d=$("#name"),e=$("#tel"),f=$("#contact"),g=!0;if(g=b.validateItem(d[0]),g&&(g=b.validateItem(e[0])),g&&(g=b.validateItem(f[0])),!g)return!1;var h={userName:d.val(),mobile:e.val(),source:1,oppName:b.oppName,planId:b.planId,notifyAnswerId:b.notifyAnswerId,insureNum:b.insureNum,contactTime:f.find(".hz-select-option-selected").text(),url:document.referrer,yuyueType:2,yuyueChildType:4};b.lodding=!0,a.request.getCrossJson({url:"//www.huize.com/yuyueactivity/AddYuyueByMobile",data:h},function(a){a.IsSuccess?(c.open({type:1,skin:"layui-layer-demo",closeBtn:1,shift:2,title:!1,area:["230px"],btn:["确认"],shadeClose:!0,content:'<div class="pt45 pb45 tac">预约成功</div>',btn1:function(){c.closeAll(),window.location.href=window.location.href}}),$(".layui-layer-btn0").removeClass("layui-layer-btn0").addClass("layui-layer-btn1"),b.getYuyueCount(!0),b.clearData()):c.open({type:1,skin:"layui-layer-demo",closeBtn:1,shift:2,title:!1,area:["230px"],btn:["确认"],shadeClose:!0,content:'<div class="pt45 pb45 tac">预约失败</div>',btn1:function(){c.closeAll()}}),b.lodding=!1}),ga("send","event","maibaoxian","dignzhi","baoxianfanganyuyue",1)},getYuyueCount:function(b){var c={},d=(new Date).valueOf();c={isAdd:b,dateTiem:d},a.request.getCrossJson({url:"//lf.huize.com/PlanAppointment/AddPlanAppointment/",data:c},function(a){$("#reserveCount").html(a)})},checkName:function(a){return new RegExp("^[\\sA-Za-z_\\u4e00-\\u9fa5]{2,50}$").test(a)},clearData:function(){var a=$("#name"),b=$("#tel"),c=$("#contact");a.val(""),b.val(""),c.find(".input-select-text").html("联系时段"),c.find(".hz-select-option-selected").removeClass(".hz-select-option-selected")}};return d});