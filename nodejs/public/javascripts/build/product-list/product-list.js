/**
 ** 
 ** www.huize.com; 
 ** Version:0.1.0;
 ** Last Updated:2016-08-09; 
 **
 **/
define(["jquery","my-calendar","helper","fixed-tool-float","animate-fly","kkpager"],function($,a,b,c,d){"use strict";var e={toolFloat:{},init:function(){var a=this;a.initEvent(),a.getHistory(),a.initDate(),$.each($(".hz-dropdown,.select-tag"),function(){a.initDropDown(this)})},initEvent:function(){var a=this;$(".select-column").each(function(){var a=$(this);if(a.find(".js-select-content").height()>50){var b=$('<a class="select-toggle" href="javascript:;"><span>更多</span> <i class="iconfont">&#xe70b;</i></a>').click(function(){a.find(".select-list").toggleClass("select-list-open"),$(this).toggleClass("show-more").find("span").text($(this).hasClass("show-more")?"隐藏":"更多")});a.append(b)}});var d=$("#subCategory").val()||"0",e=$("#companyId").val()||"0",f=$("#queryKeys").val()||"0",g=$("#genes").val()||"0",h=$("#sortType").val()||"0",i=$("#filter").val()||"0",j=$("#pageIndex").val()||0,k=$("#totalCount").val()||0,l="true"===$("#ageGenes").val()?1:0,m="/product/ins-"+d+"-"+e+"-"+f+("0"===g?"":"-"+g);1!==j&&(kkpager.generPageHtml({pno:$("#pageIndex").val(),total:Math.ceil(k/10),totalRecords:k,hrefFormer:m,hrefLatter:"?filter="+i+(1===l?"&ageGenes=1":"")+"&sort="+h+"&page=",getLink:function(a){return 1===a?this.hrefFormer:this.hrefFormer+this.hrefLatter+a},mode:"link",isGoPage:!1,isShowTotalPage:!1,isShowCurrPage:!1,lang:{firstPageText:"首页",firstPageTipText:"首页",lastPageText:"尾页",lastPageTipText:"尾页",prePageText:"上一页",prePageTipText:"上一页",nextPageText:"下一页",nextPageTipText:"下一页"}}),kkpager.selectPage($("#pageIndex").val())),$(".sort-link").click(function(){var a=$(this).attr("sortId");"0"===a?window.location.href=m:a===i?(h="0"===h?"1":"0",window.location.href=m+"?filter="+a+(1===l?"&ageGenes=1":"")+"&sort="+h):"2"===a?window.location.href=m+"?filter="+a+(1===l?"&ageGenes=1":"")+"&sort=0":window.location.href=m+"?filter="+a+(1===l?"&ageGenes=1":"")+"&sort=1"}),$(".user-defined").click(function(){var a=$(this),b=a.attr("definedType"),c=a.prev().find(".input-text").val(),h=g.split("_")[0]||"0",i=g.split("_")[1]||"0";if(!c)return!1;if("age"===b){try{c=~~c}catch(j){c=0}h=c,window.location.href="/product/ins-"+d+"-"+e+"-"+f+"-"+h+"_"+i+(0===~~h?"?ageGenes=1":"")}else i=c,window.location.href="/product/ins-"+d+"-"+e+"-"+f+"-"+h+"_"+i+(1===l?"?ageGenes=1":"")}),a.toolFloat=new c,$(".hz-product-list").delegate(".add-compare","click",function(){var b=$(this);if($(this).hasClass("hz-check-item-checked"))$(this).removeClass("hz-check-item-checked"),a.toolFloat.delcomparePro($(this).attr("planId")||$(this).attr("productId")),$(this).find(".hz-check-text").text("加入对比");else{if(a.toolFloat.getCompareCount()>=4)return void layer.msg("对比数目最大不能超过4个");$(this).addClass("hz-check-item-checked"),$("#fixedsidetool").css("right",0),$("#wrapToolMenu").css("left",0),a.animateFly($(this),$("#compareCount"),function(){a.toolFloat.addcomparePro(b.attr("planId")||b.attr("productId"))})}});var n=b.cookie.getCookie("compareProducts"),o=n.split(",")||[];$.each(o,function(){$(".add-compare[planid="+this+"]").addClass("hz-check-item-checked")}),$(".self-define").blur(function(){var a=$(this),b=a.val();b?a.nextAll(".unit").removeClass("fn-hide"):a.nextAll(".unit").addClass("fn-hide")}),$(".only-number").enterOnlyNumber()},getHistory:function(){var a=b.cookie.getCookie("Product_History"),c=a.split(","),d=[];c=$.grep(c,function(a){return""!==a}),$.each(c,function(a){this.split(":")[1]&&d.push(this.split(":")[1])}),b.request.postData2({url:"/api/products/plans/list",data:d},function(a){if(a.result.length){var b=a.result||[],c=b.filter(function(a,b){return 1===a.productStatus})||[],d=[];d.push('<ul class="view-history-list clearfix"  style="position: relative; left: 0px;margin-right:0px" id="viewWraper" index="1" >'),$.each(c,function(a,b){var c="//www.huize.com/product/detail-"+b.productId+".html?DProtectPlanId="+b.planId;d.push('<li class="view-history-item fl">'),d.push('<h4 class="view-history-item-title mt20 mb10"><a target="_blank" href="'+c+'">'+b.productName+b.planName+"</a></h4>"),d.push('<a href="'+c+'" class="product-pic" target="_blank">'),d.push('<img width="100%" src="'+b.planBigImg+'">'),d.push("</a>"),d.push("</li>")}),d.push("</ul>");var e=$(d.join("")),f=c.length,g=302*f,h=f>4?e.width(g).css("float","left").clone().attr("id","historyListClone"):"",i=$("<div id='historyViewWrap'></div>").append(e).append(h).width(g*(f>4?2:1));$("#viewContainer").html(i).scrollLeft(g),4>=f?$("#prevBtn,#nextBtn").addClass("view-history-scroll-prev-disabled"):$("#viewHistoryPage").removeClass("fn-hide")}else $("#viewContainer").hide(),$("#emptyData").show(),$("#prevBtn,#nextBtn").addClass("view-history-scroll-prev-disabled")}),this.historyAction()},historyAction:function(){$("#historyData").on("click","#nextBtn",function(){if(!($("#viewWraper li").length<4)){var a=$("#viewContainer ul").width(),b=$("#viewContainer").scrollLeft(),c=1208,d=b>a?$("#viewContainer ul").eq(0):[];2*a-b===c&&($("#historyViewWrap ul").eq(0).remove(),$("#historyViewWrap").append(d),$("#viewContainer").scrollLeft(b-a)),b=$("#viewContainer").scrollLeft(),$("#viewContainer").scrollLeft(b+302)}}).on("click","#prevBtn",function(){if(!($("#viewWraper li").length<4)){var a=$("#viewContainer ul").width(),b=$("#viewContainer").scrollLeft(),c=1208,d=$("#viewContainer ul").eq(1);b===c&&($("#historyViewWrap ul").eq(1).remove(),d.insertBefore($("#historyViewWrap ul")),$("#viewContainer").scrollLeft(b+a)),b=$("#viewContainer").scrollLeft(),$("#viewContainer").scrollLeft(b-302)}})},animateFly:function(a,b,c){var d="//img.huizecdn.com/hz/www/page/cart-flyer.png",e=$('<img class="u-flyer" src="'+d+'">').width(40).height(40),f=document.body.scrollTop||document.documentElement.scrollTop,g=a.offset().top-a.height()/2-f,h=a.offset().left+a.width()/2,i=b.offset().top+b.height()/2-f;e.fly({start:{left:h,top:g},end:{left:b.offset().left,top:i,width:0,height:0},onEnd:function(){"function"==typeof c&&c()}})},initDropDown:function(a){function b(){h.show(),f.addClass("hz-dropdown-hover")}function c(){h.hide(),f.removeClass("hz-dropdown-hover")}var d,e,f=$(a),g=f.attr("data-dropdown"),h=(f.find(".input-select .iconfont"),$("[data-dropdown-item="+g+"]"));f.on("mouseenter",function(){e=setTimeout(b,200)}).on("mouseleave",function(){clearTimeout(e),d=setTimeout(c,100)}),h.on("mouseenter",function(){clearTimeout(d)}).on("mouseleave",function(){d=setTimeout(c,100)})},initDate:function(){var b=this;$(".Wdate").not(".bind").each(function(){var c;$(this).parents("[data-dropdown-item]").length>0?(c=$(this).parents("[data-dropdown-item]")[0],new a({el:this,parent:c,zIndex:9999999999,top:function(){var a=0;return this.parent&&(a=this.parent.top),a},left:function(){var a=0;return this.parent&&(a=this.parent.left),a},maxDate:function(){var a="2100-12-31",b=new Date;return a=b.getFullYear()+"-"+(~~b.getMonth()+1)+"-"+b.getDate()},minDate:function(){var a="1900-1-1";return a},callback:function(a,c){var d=$(this.el).prev("input"),e=b.getFullAge(a);d.val(e),d.blur()}})):new a({el:this,zIndex:9999999999,maxDate:function(){var a="2100-12-31",b=new Date;return a=b.getFullYear()+"-"+(~~b.getMonth()+1)+"-"+b.getDate()},minDate:function(){var a="1900-1-1";return a},callback:function(a,c){var d=$(this.el).prev("input"),e=b.getFullAge(a);d.val(e),d.blur()}})})},getFullAge:function(a){var b=new Date,c=new Date(a),d=0,e=0,f=0,g=0;return d=b.getFullYear()-c.getFullYear(),e=b.getMonth()-c.getMonth(),f=b.getDate()-c.getDate(),0>e?g=-1:0===e&&0>f&&(g=-1),d+g}};return e});